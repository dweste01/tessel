function e(e,t,r){c&&console.log("Verifying signature..."),e.readSignature(function(n,o){return n?void(r&&r(n)):t!=o?void(r&&r(Error("Invalid Module signature. Are you sure you plugged in the right module?"))):(c&&console.log("Verified"),void e.eraseChip(function(){c&&console.log("Flash cleared."),e.programFuses(function(e){e?console.log(e):r()})}))})}function t(e,t){c&&console.log("Parsing hex file..."),e.readPagesFromHexFile(function(r,n){if(r)return c&&console.log("Parse error: ",r),void(t&&t(r));c&&console.log("Flashing chip memory"),console.warn("Uploading new firmware..."),e.flashImage(n,function(){console.warn("Update finished!"),t()})})}function r(e,t){return!!e&&(t&&t(e),!0)}function n(e,t,n,i){o(e,t,n,function(u,f,s){if(!r(u,i))return f===t&&s===n?void(i&&i()):void e.writeEEPROM([t,n],0,function(u){r(u,i)||o(e,t,n,function(e,r,o){if(i){var e;r!=t&&o!=n&&(e=Error("Unable to write to EEPROM.")),i(e)}})})})}function o(e,t,r,n){e.readEEPROM(2,0,function(e,t){n&&(e?n(e):n(null,t[0],t[1]))})}function i(r,o,i){var u=a.use(r,{pageSize:64,fileName:o.firmwareFile}),f=new s;f.place(function(){e(u,o.signature,function(e){if(e)return void(i&&i(e));f.next()})}),f.place(function(){t(u,function(e){if(e)return void(i&&i(e));f.next()})}),f.place(function(){setTimeout(function(){n(u,o.moduleID,o.firmwareVersion,function(){i&&i()})},1e3)})}function u(e,t){a.use(e).readSignature(t)}var f=require("tessel"),s=require("sync-queue"),a=require("avr-isp"),c=!1;module.exports.updateFirmware=i,module.exports.getSignature=u;